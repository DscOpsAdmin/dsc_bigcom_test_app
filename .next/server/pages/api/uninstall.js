"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/uninstall";
exports.ids = ["pages/api/uninstall"];
exports.modules = {

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "mysql":
/*!************************!*\
  !*** external "mysql" ***!
  \************************/
/***/ ((module) => {

module.exports = require("mysql");

/***/ }),

/***/ "node-bigcommerce":
/*!***********************************!*\
  !*** external "node-bigcommerce" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node-bigcommerce");

/***/ }),

/***/ "firebase/app":
/*!*******************************!*\
  !*** external "firebase/app" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("firebase/app");;

/***/ }),

/***/ "firebase/firestore":
/*!*************************************!*\
  !*** external "firebase/firestore" ***!
  \*************************************/
/***/ ((module) => {

module.exports = import("firebase/firestore");;

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(api)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"bigcommerceClient\": () => (/* binding */ bigcommerceClient),\n/* harmony export */   \"decodePayload\": () => (/* binding */ decodePayload),\n/* harmony export */   \"encodePayload\": () => (/* binding */ encodePayload),\n/* harmony export */   \"getBCAuth\": () => (/* binding */ getBCAuth),\n/* harmony export */   \"getBCVerify\": () => (/* binding */ getBCVerify),\n/* harmony export */   \"getSession\": () => (/* binding */ getSession),\n/* harmony export */   \"logoutUser\": () => (/* binding */ logoutUser),\n/* harmony export */   \"removeDataStore\": () => (/* binding */ removeDataStore),\n/* harmony export */   \"removeUserData\": () => (/* binding */ removeUserData),\n/* harmony export */   \"setSession\": () => (/* binding */ setSession)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_bigcommerce__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node-bigcommerce */ \"node-bigcommerce\");\n/* harmony import */ var node_bigcommerce__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_bigcommerce__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(api)/./lib/db.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_2__]);\n_db__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\nconst _excluded = [\"user\", \"owner\"];\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\nconst {\n  API_URL,\n  APP_BASE_URL,\n  CLIENT_ID,\n  CLIENT_SECRET,\n  JWT_KEY,\n  LOGIN_URL\n} = process.env; // Used for internal configuration; 3rd party apps may remove\n\nconst apiConfig = {};\n\nif (API_URL && LOGIN_URL) {\n  apiConfig.apiUrl = API_URL;\n  apiConfig.loginUrl = LOGIN_URL;\n} // Create BigCommerce instance\n// https://github.com/bigcommerce/node-bigcommerce/\n\n\nconst bigcommerce = new node_bigcommerce__WEBPACK_IMPORTED_MODULE_1__(_objectSpread({\n  logLevel: 'info',\n  clientId: CLIENT_ID,\n  secret: CLIENT_SECRET,\n  callback: APP_BASE_URL + \"/api/auth\",\n  responseType: 'json',\n  headers: {\n    'Accept-Encoding': '*'\n  },\n  apiVersion: 'v3'\n}, apiConfig));\nconst bigcommerceSigned = new node_bigcommerce__WEBPACK_IMPORTED_MODULE_1__({\n  secret: CLIENT_SECRET,\n  responseType: 'json'\n});\nfunction bigcommerceClient(accessToken, storeHash, apiVersion = 'v3') {\n  return new node_bigcommerce__WEBPACK_IMPORTED_MODULE_1__(_objectSpread({\n    clientId: CLIENT_ID,\n    accessToken,\n    storeHash,\n    responseType: 'json',\n    apiVersion\n  }, apiConfig));\n} // Authorizes app on install\n\nfunction getBCAuth(query) {\n  return bigcommerce.authorize(query);\n} // Verifies app on load/ uninstall\n\nfunction getBCVerify({\n  signed_payload_jwt\n}) {\n  return bigcommerceSigned.verifyJWT(signed_payload_jwt);\n}\nfunction setSession(session) {\n  _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].setUser(session);\n  _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].setStore(session);\n  _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].setStoreUser(session);\n}\nasync function getSession({\n  query: {\n    context = ''\n  }\n}) {\n  if (typeof context !== 'string') return;\n  const {\n    context: storeHash,\n    user\n  } = decodePayload(context);\n  const hasUser = await _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hasStoreUser(storeHash, user === null || user === void 0 ? void 0 : user.id); // Before retrieving session/ hitting APIs, check user\n\n  if (!hasUser) {\n    throw new Error('User is not available. Please login or ensure you have access permissions.');\n  }\n\n  const accessToken = await _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].getStoreToken(storeHash);\n  return {\n    accessToken,\n    storeHash,\n    user\n  };\n} // JWT functions to sign/ verify 'context' query param from /api/auth||load\n\nfunction encodePayload(_ref) {\n  let {\n    user,\n    owner\n  } = _ref,\n      session = _objectWithoutProperties(_ref, _excluded);\n\n  const contextString = (session === null || session === void 0 ? void 0 : session.context) ?? (session === null || session === void 0 ? void 0 : session.sub);\n  const context = contextString.split('/')[1] || '';\n  return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__.sign({\n    context,\n    user,\n    owner\n  }, JWT_KEY, {\n    expiresIn: '24h'\n  });\n} // Verifies JWT for getSession (product APIs)\n\nfunction decodePayload(encodedContext) {\n  return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__.verify(encodedContext, JWT_KEY);\n} // Removes store and storeUser on uninstall\n\nasync function removeDataStore(session) {\n  await _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].deleteStore(session);\n  await _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].deleteUser(session);\n} // Removes users from app - getSession() for user will fail after user is removed\n\nasync function removeUserData(session) {\n  await _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].deleteUser(session);\n} // Removes user from storeUsers on logout\n\nasync function logoutUser({\n  storeHash,\n  user\n}) {\n  const session = {\n    context: `store/${storeHash}`,\n    user\n  };\n  await _db__WEBPACK_IMPORTED_MODULE_2__[\"default\"].deleteUser(session);\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZSxhQUFhLEdBQUcsQ0FBQWYsT0FBTyxTQUFQLElBQUFBLE9BQU8sV0FBUCxZQUFBQSxPQUFPLENBQUVLLE9BQVQsTUFBb0JMLE9BQXBCLGFBQW9CQSxPQUFwQix1QkFBb0JBLE9BQU8sQ0FBRWdCLEdBQTdCLENBQXRCO0VBQ0EsTUFBTVgsT0FBTyxHQUFHVSxhQUFhLENBQUNFLEtBQWQsQ0FBb0IsR0FBcEIsRUFBeUIsQ0FBekIsS0FBK0IsRUFBL0M7RUFFQSxPQUFPbEQsOENBQUEsQ0FBUztJQUFFc0MsT0FBRjtJQUFXQyxJQUFYO0lBQWlCUTtFQUFqQixDQUFULEVBQW1DeEMsT0FBbkMsRUFBNEM7SUFBRTZDLFNBQVMsRUFBRTtFQUFiLENBQTVDLENBQVA7QUFDSCxFQUNEOztBQUNPLFNBQVNaLGFBQVQsQ0FBdUJhLGNBQXZCLEVBQStDO0VBQ2xELE9BQU9yRCxnREFBQSxDQUFXcUQsY0FBWCxFQUEyQjlDLE9BQTNCLENBQVA7QUFDSCxFQUVEOztBQUNPLGVBQWVnRCxlQUFmLENBQStCdEIsT0FBL0IsRUFBc0Q7RUFDekQsTUFBTS9CLHVEQUFBLENBQWUrQixPQUFmLENBQU47RUFDQSxNQUFNL0Isc0RBQUEsQ0FBYytCLE9BQWQsQ0FBTjtBQUNILEVBRUQ7O0FBQ08sZUFBZXlCLGNBQWYsQ0FBOEJ6QixPQUE5QixFQUFxRDtFQUN4RCxNQUFNL0Isc0RBQUEsQ0FBYytCLE9BQWQsQ0FBTjtBQUNILEVBRUQ7O0FBQ08sZUFBZTBCLFVBQWYsQ0FBMEI7RUFBRWxDLFNBQUY7RUFBYWM7QUFBYixDQUExQixFQUFvRTtFQUN2RSxNQUFNTixPQUFPLEdBQUc7SUFBRUssT0FBTyxFQUFHLFNBQVFiLFNBQVUsRUFBOUI7SUFBaUNjO0VBQWpDLENBQWhCO0VBQ0EsTUFBTXJDLHNEQUFBLENBQWMrQixPQUFkLENBQU47QUFDSCxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2FtcGxlLWFwcC1ub2RlanMvLi9saWIvYXV0aC50cz9iZjdlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xyXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgKiBhcyBCaWdDb21tZXJjZSBmcm9tICdub2RlLWJpZ2NvbW1lcmNlJztcclxuaW1wb3J0IHsgQXBpQ29uZmlnLCBRdWVyeVBhcmFtcywgU2Vzc2lvbkNvbnRleHRQcm9wcywgU2Vzc2lvblByb3BzIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgZGIgZnJvbSAnLi9kYic7XHJcblxyXG5jb25zdCB7IEFQSV9VUkwsIEFQUF9CQVNFX1VSTCwgQ0xJRU5UX0lELCBDTElFTlRfU0VDUkVULCBKV1RfS0VZLCBMT0dJTl9VUkwgfSA9IHByb2Nlc3MuZW52O1xyXG5cclxuLy8gVXNlZCBmb3IgaW50ZXJuYWwgY29uZmlndXJhdGlvbjsgM3JkIHBhcnR5IGFwcHMgbWF5IHJlbW92ZVxyXG5jb25zdCBhcGlDb25maWc6IEFwaUNvbmZpZyA9IHt9O1xyXG5pZiAoQVBJX1VSTCAmJiBMT0dJTl9VUkwpIHtcclxuICAgIGFwaUNvbmZpZy5hcGlVcmwgPSBBUElfVVJMO1xyXG4gICAgYXBpQ29uZmlnLmxvZ2luVXJsID0gTE9HSU5fVVJMO1xyXG59XHJcblxyXG4vLyBDcmVhdGUgQmlnQ29tbWVyY2UgaW5zdGFuY2VcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2JpZ2NvbW1lcmNlL25vZGUtYmlnY29tbWVyY2UvXHJcbmNvbnN0IGJpZ2NvbW1lcmNlID0gbmV3IEJpZ0NvbW1lcmNlKHtcclxuICAgIGxvZ0xldmVsOiAnaW5mbycsXHJcbiAgICBjbGllbnRJZDogQ0xJRU5UX0lELFxyXG4gICAgc2VjcmV0OiBDTElFTlRfU0VDUkVULFxyXG4gICAgY2FsbGJhY2s6IEFQUF9CQVNFX1VSTCtcIi9hcGkvYXV0aFwiLFxyXG4gICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXHJcbiAgICBoZWFkZXJzOiB7ICdBY2NlcHQtRW5jb2RpbmcnOiAnKicgfSxcclxuICAgIGFwaVZlcnNpb246ICd2MycsXHJcbiAgICAuLi5hcGlDb25maWcsXHJcbn0pO1xyXG5cclxuY29uc3QgYmlnY29tbWVyY2VTaWduZWQgPSBuZXcgQmlnQ29tbWVyY2Uoe1xyXG4gICAgc2VjcmV0OiBDTElFTlRfU0VDUkVULFxyXG4gICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXHJcbn0pO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJpZ2NvbW1lcmNlQ2xpZW50KGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHN0b3JlSGFzaDogc3RyaW5nLCBhcGlWZXJzaW9uID0gJ3YzJykge1xyXG4gICAgcmV0dXJuIG5ldyBCaWdDb21tZXJjZSh7XHJcbiAgICAgICAgY2xpZW50SWQ6IENMSUVOVF9JRCxcclxuICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICBzdG9yZUhhc2gsXHJcbiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXHJcbiAgICAgICAgYXBpVmVyc2lvbixcclxuICAgICAgICAuLi5hcGlDb25maWcsXHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gQXV0aG9yaXplcyBhcHAgb24gaW5zdGFsbFxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QkNBdXRoKHF1ZXJ5OiBRdWVyeVBhcmFtcykge1xyXG4gICAgcmV0dXJuIGJpZ2NvbW1lcmNlLmF1dGhvcml6ZShxdWVyeSk7XHJcbn1cclxuLy8gVmVyaWZpZXMgYXBwIG9uIGxvYWQvIHVuaW5zdGFsbFxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QkNWZXJpZnkoeyBzaWduZWRfcGF5bG9hZF9qd3QgfTogUXVlcnlQYXJhbXMpIHtcclxuICAgIHJldHVybiBiaWdjb21tZXJjZVNpZ25lZC52ZXJpZnlKV1Qoc2lnbmVkX3BheWxvYWRfand0KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldFNlc3Npb24oc2Vzc2lvbjogU2Vzc2lvblByb3BzKSB7XHJcbiAgICBkYi5zZXRVc2VyKHNlc3Npb24pO1xyXG4gICAgZGIuc2V0U3RvcmUoc2Vzc2lvbik7XHJcbiAgICBkYi5zZXRTdG9yZVVzZXIoc2Vzc2lvbik7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXNzaW9uKHsgcXVlcnk6IHsgY29udGV4dCA9ICcnIH0gfTogTmV4dEFwaVJlcXVlc3QpIHtcclxuICAgIGlmICh0eXBlb2YgY29udGV4dCAhPT0gJ3N0cmluZycpIHJldHVybjtcclxuICAgIGNvbnN0IHsgY29udGV4dDogc3RvcmVIYXNoLCB1c2VyIH0gPSBkZWNvZGVQYXlsb2FkKGNvbnRleHQpO1xyXG4gICAgY29uc3QgaGFzVXNlciA9IGF3YWl0IGRiLmhhc1N0b3JlVXNlcihzdG9yZUhhc2gsIHVzZXI/LmlkKTtcclxuXHJcbiAgICAvLyBCZWZvcmUgcmV0cmlldmluZyBzZXNzaW9uLyBoaXR0aW5nIEFQSXMsIGNoZWNrIHVzZXJcclxuICAgIGlmICghaGFzVXNlcikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBpcyBub3QgYXZhaWxhYmxlLiBQbGVhc2UgbG9naW4gb3IgZW5zdXJlIHlvdSBoYXZlIGFjY2VzcyBwZXJtaXNzaW9ucy4nKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGRiLmdldFN0b3JlVG9rZW4oc3RvcmVIYXNoKTtcclxuXHJcbiAgICByZXR1cm4geyBhY2Nlc3NUb2tlbiwgc3RvcmVIYXNoLCB1c2VyIH07XHJcbn1cclxuXHJcbi8vIEpXVCBmdW5jdGlvbnMgdG8gc2lnbi8gdmVyaWZ5ICdjb250ZXh0JyBxdWVyeSBwYXJhbSBmcm9tIC9hcGkvYXV0aHx8bG9hZFxyXG5leHBvcnQgZnVuY3Rpb24gZW5jb2RlUGF5bG9hZCh7IHVzZXIsIG93bmVyLCAuLi5zZXNzaW9uIH06IFNlc3Npb25Qcm9wcykge1xyXG4gICAgY29uc3QgY29udGV4dFN0cmluZyA9IHNlc3Npb24/LmNvbnRleHQgPz8gc2Vzc2lvbj8uc3ViO1xyXG4gICAgY29uc3QgY29udGV4dCA9IGNvbnRleHRTdHJpbmcuc3BsaXQoJy8nKVsxXSB8fCAnJztcclxuXHJcbiAgICByZXR1cm4gand0LnNpZ24oeyBjb250ZXh0LCB1c2VyLCBvd25lciB9LCBKV1RfS0VZLCB7IGV4cGlyZXNJbjogJzI0aCcgfSk7XHJcbn1cclxuLy8gVmVyaWZpZXMgSldUIGZvciBnZXRTZXNzaW9uIChwcm9kdWN0IEFQSXMpXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVQYXlsb2FkKGVuY29kZWRDb250ZXh0OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBqd3QudmVyaWZ5KGVuY29kZWRDb250ZXh0LCBKV1RfS0VZKTtcclxufVxyXG5cclxuLy8gUmVtb3ZlcyBzdG9yZSBhbmQgc3RvcmVVc2VyIG9uIHVuaW5zdGFsbFxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlRGF0YVN0b3JlKHNlc3Npb246IFNlc3Npb25Qcm9wcykge1xyXG4gICAgYXdhaXQgZGIuZGVsZXRlU3RvcmUoc2Vzc2lvbik7XHJcbiAgICBhd2FpdCBkYi5kZWxldGVVc2VyKHNlc3Npb24pO1xyXG59XHJcblxyXG4vLyBSZW1vdmVzIHVzZXJzIGZyb20gYXBwIC0gZ2V0U2Vzc2lvbigpIGZvciB1c2VyIHdpbGwgZmFpbCBhZnRlciB1c2VyIGlzIHJlbW92ZWRcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbW92ZVVzZXJEYXRhKHNlc3Npb246IFNlc3Npb25Qcm9wcykge1xyXG4gICAgYXdhaXQgZGIuZGVsZXRlVXNlcihzZXNzaW9uKTtcclxufVxyXG5cclxuLy8gUmVtb3ZlcyB1c2VyIGZyb20gc3RvcmVVc2VycyBvbiBsb2dvdXRcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ291dFVzZXIoeyBzdG9yZUhhc2gsIHVzZXIgfTogU2Vzc2lvbkNvbnRleHRQcm9wcykge1xyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHsgY29udGV4dDogYHN0b3JlLyR7c3RvcmVIYXNofWAsIHVzZXIgfTtcclxuICAgIGF3YWl0IGRiLmRlbGV0ZVVzZXIoc2Vzc2lvbik7XHJcbn1cclxuIl0sIm5hbWVzIjpbImp3dCIsIkJpZ0NvbW1lcmNlIiwiZGIiLCJBUElfVVJMIiwiQVBQX0JBU0VfVVJMIiwiQ0xJRU5UX0lEIiwiQ0xJRU5UX1NFQ1JFVCIsIkpXVF9LRVkiLCJMT0dJTl9VUkwiLCJwcm9jZXNzIiwiZW52IiwiYXBpQ29uZmlnIiwiYXBpVXJsIiwibG9naW5VcmwiLCJiaWdjb21tZXJjZSIsImxvZ0xldmVsIiwiY2xpZW50SWQiLCJzZWNyZXQiLCJjYWxsYmFjayIsInJlc3BvbnNlVHlwZSIsImhlYWRlcnMiLCJhcGlWZXJzaW9uIiwiYmlnY29tbWVyY2VTaWduZWQiLCJiaWdjb21tZXJjZUNsaWVudCIsImFjY2Vzc1Rva2VuIiwic3RvcmVIYXNoIiwiZ2V0QkNBdXRoIiwicXVlcnkiLCJhdXRob3JpemUiLCJnZXRCQ1ZlcmlmeSIsInNpZ25lZF9wYXlsb2FkX2p3dCIsInZlcmlmeUpXVCIsInNldFNlc3Npb24iLCJzZXNzaW9uIiwic2V0VXNlciIsInNldFN0b3JlIiwic2V0U3RvcmVVc2VyIiwiZ2V0U2Vzc2lvbiIsImNvbnRleHQiLCJ1c2VyIiwiZGVjb2RlUGF5bG9hZCIsImhhc1VzZXIiLCJoYXNTdG9yZVVzZXIiLCJpZCIsIkVycm9yIiwiZ2V0U3RvcmVUb2tlbiIsImVuY29kZVBheWxvYWQiLCJvd25lciIsImNvbnRleHRTdHJpbmciLCJzdWIiLCJzcGxpdCIsInNpZ24iLCJleHBpcmVzSW4iLCJlbmNvZGVkQ29udGV4dCIsInZlcmlmeSIsInJlbW92ZURhdGFTdG9yZSIsImRlbGV0ZVN0b3JlIiwiZGVsZXRlVXNlciIsInJlbW92ZVVzZXJEYXRhIiwibG9nb3V0VXNlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/auth.ts\n");

/***/ }),

/***/ "(api)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _dbs_firebase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dbs/firebase */ \"(api)/./lib/dbs/firebase.ts\");\n/* harmony import */ var _dbs_mysql__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dbs/mysql */ \"(api)/./lib/dbs/mysql.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_dbs_firebase__WEBPACK_IMPORTED_MODULE_0__]);\n_dbs_firebase__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst {\n  DB_TYPE\n} = process.env;\nlet db;\n\nswitch (DB_TYPE) {\n  case 'firebase':\n    db = _dbs_firebase__WEBPACK_IMPORTED_MODULE_0__;\n    break;\n\n  case 'mysql':\n    db = _dbs_mysql__WEBPACK_IMPORTED_MODULE_1__;\n    break;\n\n  default:\n    db = _dbs_firebase__WEBPACK_IMPORTED_MODULE_0__;\n    break;\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (db);\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZGIudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUVBLE1BQU07RUFBRUU7QUFBRixJQUFjQyxPQUFPLENBQUNDLEdBQTVCO0FBRUEsSUFBSUMsRUFBSjs7QUFFQSxRQUFRSCxPQUFSO0VBQ0ksS0FBSyxVQUFMO0lBQ0lHLEVBQUUsR0FBR0wsMENBQUw7SUFDQTs7RUFDSixLQUFLLE9BQUw7SUFDSUssRUFBRSxHQUFHSix1Q0FBTDtJQUNBOztFQUNKO0lBQ0lJLEVBQUUsR0FBR0wsMENBQUw7SUFDQTtBQVRSOztBQVlBLGlFQUFlSyxFQUFmLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYW1wbGUtYXBwLW5vZGVqcy8uL2xpYi9kYi50cz8xZGYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERiIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgKiBhcyBmaXJlYmFzZURCIGZyb20gJy4vZGJzL2ZpcmViYXNlJztcclxuaW1wb3J0ICogYXMgc3FsREIgZnJvbSAnLi9kYnMvbXlzcWwnO1xyXG5cclxuY29uc3QgeyBEQl9UWVBFIH0gPSBwcm9jZXNzLmVudjtcclxuXHJcbmxldCBkYjogRGI7XHJcblxyXG5zd2l0Y2ggKERCX1RZUEUpIHtcclxuICAgIGNhc2UgJ2ZpcmViYXNlJzpcclxuICAgICAgICBkYiA9IGZpcmViYXNlREI7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdteXNxbCc6XHJcbiAgICAgICAgZGIgPSBzcWxEQjtcclxuICAgICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgZGIgPSBmaXJlYmFzZURCO1xyXG4gICAgICAgIGJyZWFrO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBkYjtcclxuIl0sIm5hbWVzIjpbImZpcmViYXNlREIiLCJzcWxEQiIsIkRCX1RZUEUiLCJwcm9jZXNzIiwiZW52IiwiZGIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/db.ts\n");

/***/ }),

/***/ "(api)/./lib/dbs/firebase.ts":
/*!*****************************!*\
  !*** ./lib/dbs/firebase.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"deleteStore\": () => (/* binding */ deleteStore),\n/* harmony export */   \"deleteUser\": () => (/* binding */ deleteUser),\n/* harmony export */   \"getStoreToken\": () => (/* binding */ getStoreToken),\n/* harmony export */   \"hasStoreUser\": () => (/* binding */ hasStoreUser),\n/* harmony export */   \"setStore\": () => (/* binding */ setStore),\n/* harmony export */   \"setStoreUser\": () => (/* binding */ setStoreUser),\n/* harmony export */   \"setUser\": () => (/* binding */ setUser)\n/* harmony export */ });\n/* harmony import */ var firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/app */ \"firebase/app\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__]);\n([firebase_app__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n// Firebase config and initialization\n// Prod applications might use config file\nconst {\n  FIRE_API_KEY,\n  FIRE_DOMAIN,\n  FIRE_PROJECT_ID\n} = process.env;\nconst firebaseConfig = {\n  apiKey: FIRE_API_KEY,\n  authDomain: FIRE_DOMAIN,\n  projectId: FIRE_PROJECT_ID\n};\nconst app = (0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.initializeApp)(firebaseConfig);\nconst db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)(app); // Firestore data management functions\n// Use setUser for storing global user data (persists between installs)\n\nasync function setUser({\n  user\n}) {\n  if (!user) return null;\n  const {\n    email,\n    id,\n    username\n  } = user;\n  const ref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'users', String(id));\n  const data = {\n    email\n  };\n\n  if (username) {\n    data.username = username;\n  }\n\n  await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.setDoc)(ref, data, {\n    merge: true\n  });\n}\nasync function setStore(session) {\n  const {\n    access_token: accessToken,\n    context,\n    scope,\n    user: {\n      id\n    }\n  } = session; // Only set on app install or update\n\n  if (!accessToken || !scope) return null;\n  const storeHash = (context === null || context === void 0 ? void 0 : context.split('/')[1]) || '';\n  const ref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'store', storeHash);\n  const data = {\n    accessToken,\n    adminId: id,\n    scope\n  };\n  await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.setDoc)(ref, data);\n} // User management for multi-user apps\n// Use setStoreUser for storing store specific variables\n\nasync function setStoreUser(session) {\n  const {\n    access_token: accessToken,\n    context,\n    owner,\n    sub,\n    user: {\n      id: userId\n    }\n  } = session;\n  if (!userId) return null;\n  const contextString = context ?? sub;\n  const storeHash = (contextString === null || contextString === void 0 ? void 0 : contextString.split('/')[1]) || '';\n  const documentId = `${userId}_${storeHash}`; // users can belong to multiple stores\n\n  const ref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'storeUsers', documentId);\n  const storeUser = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)(ref); // Set admin (store owner) if installing/ updating the app\n  // https://developer.bigcommerce.com/api-docs/apps/guide/users\n\n  if (accessToken) {\n    var _storeUser$data;\n\n    // Create a new admin user if none exists\n    if (!storeUser.exists()) {\n      await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.setDoc)(ref, {\n        storeHash,\n        isAdmin: true\n      });\n    } else if (!((_storeUser$data = storeUser.data()) !== null && _storeUser$data !== void 0 && _storeUser$data.isAdmin)) {\n      await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.updateDoc)(ref, {\n        isAdmin: true\n      });\n    }\n  } else {\n    // Create a new user if it doesn't exist\n    if (!storeUser.exists()) {\n      await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.setDoc)(ref, {\n        storeHash,\n        isAdmin: owner.id === userId\n      }); // isAdmin true if owner == user\n    }\n  }\n}\nasync function deleteUser({\n  context,\n  user,\n  sub\n}) {\n  const contextString = context ?? sub;\n  const storeHash = (contextString === null || contextString === void 0 ? void 0 : contextString.split('/')[1]) || '';\n  const docId = `${user === null || user === void 0 ? void 0 : user.id}_${storeHash}`;\n  const ref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'storeUsers', docId);\n  await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.deleteDoc)(ref);\n}\nasync function hasStoreUser(storeHash, userId) {\n  if (!storeHash || !userId) return false;\n  const docId = `${userId}_${storeHash}`;\n  const userDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'storeUsers', docId));\n  return userDoc.exists();\n}\nasync function getStoreToken(storeHash) {\n  var _storeDoc$data;\n\n  if (!storeHash) return null;\n  const storeDoc = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'store', storeHash));\n  return ((_storeDoc$data = storeDoc.data()) === null || _storeDoc$data === void 0 ? void 0 : _storeDoc$data.accessToken) ?? null;\n}\nasync function deleteStore({\n  store_hash: storeHash\n}) {\n  const ref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, 'store', storeHash);\n  await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.deleteDoc)(ref);\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QW5CLENBQWY7RUFFQSxNQUFNN0MsNkRBQVMsQ0FBQ3NCLEdBQUQsQ0FBZjtBQUNIO0FBRU0sZUFBZXdCLFlBQWYsQ0FBNEJkLFNBQTVCLEVBQStDTSxNQUEvQyxFQUErRDtFQUNsRSxJQUFJLENBQUNOLFNBQUQsSUFBYyxDQUFDTSxNQUFuQixFQUEyQixPQUFPLEtBQVA7RUFFM0IsTUFBTU8sS0FBSyxHQUFJLEdBQUVQLE1BQU8sSUFBR04sU0FBVSxFQUFyQztFQUNBLE1BQU1lLE9BQU8sR0FBRyxNQUFNN0MsMERBQU0sQ0FBQ0QsdURBQUcsQ0FBQ2UsRUFBRCxFQUFLLFlBQUwsRUFBbUI2QixLQUFuQixDQUFKLENBQTVCO0VBRUEsT0FBT0UsT0FBTyxDQUFDTCxNQUFSLEVBQVA7QUFDSDtBQUVNLGVBQWVNLGFBQWYsQ0FBNkJoQixTQUE3QixFQUFnRDtFQUFBOztFQUNuRCxJQUFJLENBQUNBLFNBQUwsRUFBZ0IsT0FBTyxJQUFQO0VBQ2hCLE1BQU1pQixRQUFRLEdBQUcsTUFBTS9DLDBEQUFNLENBQUNELHVEQUFHLENBQUNlLEVBQUQsRUFBSyxPQUFMLEVBQWNnQixTQUFkLENBQUosQ0FBN0I7RUFFQSxPQUFPLG1CQUFBaUIsUUFBUSxDQUFDekIsSUFBVCxvRUFBaUJLLFdBQWpCLEtBQWdDLElBQXZDO0FBQ0g7QUFFTSxlQUFlcUIsV0FBZixDQUEyQjtFQUFFQyxVQUFVLEVBQUVuQjtBQUFkLENBQTNCLEVBQW9FO0VBQ3ZFLE1BQU1WLEdBQUcsR0FBR3JCLHVEQUFHLENBQUNlLEVBQUQsRUFBSyxPQUFMLEVBQWNnQixTQUFkLENBQWY7RUFFQSxNQUFNaEMsNkRBQVMsQ0FBQ3NCLEdBQUQsQ0FBZjtBQUNILEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYW1wbGUtYXBwLW5vZGVqcy8uL2xpYi9kYnMvZmlyZWJhc2UudHM/MmNkMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbml0aWFsaXplQXBwIH0gZnJvbSAnZmlyZWJhc2UvYXBwJztcclxuaW1wb3J0IHsgZGVsZXRlRG9jLCBkb2MsIGdldERvYywgZ2V0RmlyZXN0b3JlLCBzZXREb2MsIHVwZGF0ZURvYyB9IGZyb20gJ2ZpcmViYXNlL2ZpcmVzdG9yZSc7XHJcbmltcG9ydCB7IFNlc3Npb25Qcm9wcywgVXNlckRhdGEgfSBmcm9tICcuLi8uLi90eXBlcyc7XHJcblxyXG4vLyBGaXJlYmFzZSBjb25maWcgYW5kIGluaXRpYWxpemF0aW9uXHJcbi8vIFByb2QgYXBwbGljYXRpb25zIG1pZ2h0IHVzZSBjb25maWcgZmlsZVxyXG5jb25zdCB7IEZJUkVfQVBJX0tFWSwgRklSRV9ET01BSU4sIEZJUkVfUFJPSkVDVF9JRCB9ID0gcHJvY2Vzcy5lbnY7XHJcbmNvbnN0IGZpcmViYXNlQ29uZmlnID0ge1xyXG4gICAgYXBpS2V5OiBGSVJFX0FQSV9LRVksXHJcbiAgICBhdXRoRG9tYWluOiBGSVJFX0RPTUFJTixcclxuICAgIHByb2plY3RJZDogRklSRV9QUk9KRUNUX0lELFxyXG59O1xyXG5jb25zdCBhcHAgPSBpbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTtcclxuY29uc3QgZGIgPSBnZXRGaXJlc3RvcmUoYXBwKTtcclxuXHJcbi8vIEZpcmVzdG9yZSBkYXRhIG1hbmFnZW1lbnQgZnVuY3Rpb25zXHJcblxyXG4vLyBVc2Ugc2V0VXNlciBmb3Igc3RvcmluZyBnbG9iYWwgdXNlciBkYXRhIChwZXJzaXN0cyBiZXR3ZWVuIGluc3RhbGxzKVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0VXNlcih7IHVzZXIgfTogU2Vzc2lvblByb3BzKSB7XHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xyXG5cclxuICAgIGNvbnN0IHsgZW1haWwsIGlkLCB1c2VybmFtZSB9ID0gdXNlcjtcclxuICAgIGNvbnN0IHJlZiA9IGRvYyhkYiwgJ3VzZXJzJywgU3RyaW5nKGlkKSk7XHJcbiAgICBjb25zdCBkYXRhOiBVc2VyRGF0YSA9IHsgZW1haWwgfTtcclxuXHJcbiAgICBpZiAodXNlcm5hbWUpIHtcclxuICAgICAgICBkYXRhLnVzZXJuYW1lID0gdXNlcm5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgc2V0RG9jKHJlZiwgZGF0YSwgeyBtZXJnZTogdHJ1ZSB9KTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldFN0b3JlKHNlc3Npb246IFNlc3Npb25Qcm9wcykge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICAgIGFjY2Vzc190b2tlbjogYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgY29udGV4dCxcclxuICAgICAgICBzY29wZSxcclxuICAgICAgICB1c2VyOiB7IGlkIH0sXHJcbiAgICB9ID0gc2Vzc2lvbjtcclxuICAgIC8vIE9ubHkgc2V0IG9uIGFwcCBpbnN0YWxsIG9yIHVwZGF0ZVxyXG4gICAgaWYgKCFhY2Nlc3NUb2tlbiB8fCAhc2NvcGUpIHJldHVybiBudWxsO1xyXG5cclxuICAgIGNvbnN0IHN0b3JlSGFzaCA9IGNvbnRleHQ/LnNwbGl0KCcvJylbMV0gfHwgJyc7XHJcbiAgICBjb25zdCByZWYgPSBkb2MoZGIsICdzdG9yZScsIHN0b3JlSGFzaCk7XHJcbiAgICBjb25zdCBkYXRhID0geyBhY2Nlc3NUb2tlbiwgYWRtaW5JZDogaWQsIHNjb3BlIH07XHJcblxyXG4gICAgYXdhaXQgc2V0RG9jKHJlZiwgZGF0YSk7XHJcbn1cclxuXHJcbi8vIFVzZXIgbWFuYWdlbWVudCBmb3IgbXVsdGktdXNlciBhcHBzXHJcbi8vIFVzZSBzZXRTdG9yZVVzZXIgZm9yIHN0b3Jpbmcgc3RvcmUgc3BlY2lmaWMgdmFyaWFibGVzXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRTdG9yZVVzZXIoc2Vzc2lvbjogU2Vzc2lvblByb3BzKSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgICAgYWNjZXNzX3Rva2VuOiBhY2Nlc3NUb2tlbixcclxuICAgICAgICBjb250ZXh0LFxyXG4gICAgICAgIG93bmVyLFxyXG4gICAgICAgIHN1YixcclxuICAgICAgICB1c2VyOiB7IGlkOiB1c2VySWQgfSxcclxuICAgIH0gPSBzZXNzaW9uO1xyXG4gICAgaWYgKCF1c2VySWQpIHJldHVybiBudWxsO1xyXG5cclxuICAgIGNvbnN0IGNvbnRleHRTdHJpbmcgPSBjb250ZXh0ID8/IHN1YjtcclxuICAgIGNvbnN0IHN0b3JlSGFzaCA9IGNvbnRleHRTdHJpbmc/LnNwbGl0KCcvJylbMV0gfHwgJyc7XHJcbiAgICBjb25zdCBkb2N1bWVudElkID0gYCR7dXNlcklkfV8ke3N0b3JlSGFzaH1gOyAvLyB1c2VycyBjYW4gYmVsb25nIHRvIG11bHRpcGxlIHN0b3Jlc1xyXG4gICAgY29uc3QgcmVmID0gZG9jKGRiLCAnc3RvcmVVc2VycycsIGRvY3VtZW50SWQpO1xyXG4gICAgY29uc3Qgc3RvcmVVc2VyID0gYXdhaXQgZ2V0RG9jKHJlZik7XHJcblxyXG4gICAgLy8gU2V0IGFkbWluIChzdG9yZSBvd25lcikgaWYgaW5zdGFsbGluZy8gdXBkYXRpbmcgdGhlIGFwcFxyXG4gICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIuYmlnY29tbWVyY2UuY29tL2FwaS1kb2NzL2FwcHMvZ3VpZGUvdXNlcnNcclxuICAgIGlmIChhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBhZG1pbiB1c2VyIGlmIG5vbmUgZXhpc3RzXHJcbiAgICAgICAgaWYgKCFzdG9yZVVzZXIuZXhpc3RzKCkpIHtcclxuICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHJlZiwgeyBzdG9yZUhhc2gsIGlzQWRtaW46IHRydWUgfSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICghc3RvcmVVc2VyLmRhdGEoKT8uaXNBZG1pbikge1xyXG4gICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocmVmLCB7IGlzQWRtaW46IHRydWUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgdXNlciBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgICAgaWYgKCFzdG9yZVVzZXIuZXhpc3RzKCkpIHtcclxuICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHJlZiwgeyBzdG9yZUhhc2gsIGlzQWRtaW46IG93bmVyLmlkID09PSB1c2VySWQgfSk7IC8vIGlzQWRtaW4gdHJ1ZSBpZiBvd25lciA9PSB1c2VyXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlVXNlcih7IGNvbnRleHQsIHVzZXIsIHN1YiB9OiBTZXNzaW9uUHJvcHMpIHtcclxuICAgIGNvbnN0IGNvbnRleHRTdHJpbmcgPSBjb250ZXh0ID8/IHN1YjtcclxuICAgIGNvbnN0IHN0b3JlSGFzaCA9IGNvbnRleHRTdHJpbmc/LnNwbGl0KCcvJylbMV0gfHwgJyc7XHJcbiAgICBjb25zdCBkb2NJZCA9IGAke3VzZXI/LmlkfV8ke3N0b3JlSGFzaH1gO1xyXG4gICAgY29uc3QgcmVmID0gZG9jKGRiLCAnc3RvcmVVc2VycycsIGRvY0lkKTtcclxuXHJcbiAgICBhd2FpdCBkZWxldGVEb2MocmVmKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc1N0b3JlVXNlcihzdG9yZUhhc2g6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcclxuICAgIGlmICghc3RvcmVIYXNoIHx8ICF1c2VySWQpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICBjb25zdCBkb2NJZCA9IGAke3VzZXJJZH1fJHtzdG9yZUhhc2h9YDtcclxuICAgIGNvbnN0IHVzZXJEb2MgPSBhd2FpdCBnZXREb2MoZG9jKGRiLCAnc3RvcmVVc2VycycsIGRvY0lkKSk7XHJcblxyXG4gICAgcmV0dXJuIHVzZXJEb2MuZXhpc3RzKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTdG9yZVRva2VuKHN0b3JlSGFzaDogc3RyaW5nKSB7XHJcbiAgICBpZiAoIXN0b3JlSGFzaCkgcmV0dXJuIG51bGw7XHJcbiAgICBjb25zdCBzdG9yZURvYyA9IGF3YWl0IGdldERvYyhkb2MoZGIsICdzdG9yZScsIHN0b3JlSGFzaCkpO1xyXG5cclxuICAgIHJldHVybiBzdG9yZURvYy5kYXRhKCk/LmFjY2Vzc1Rva2VuID8/IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVTdG9yZSh7IHN0b3JlX2hhc2g6IHN0b3JlSGFzaCB9OiBTZXNzaW9uUHJvcHMpIHtcclxuICAgIGNvbnN0IHJlZiA9IGRvYyhkYiwgJ3N0b3JlJywgc3RvcmVIYXNoKTtcclxuXHJcbiAgICBhd2FpdCBkZWxldGVEb2MocmVmKTtcclxufVxyXG4iXSwibmFtZXMiOlsiaW5pdGlhbGl6ZUFwcCIsImRlbGV0ZURvYyIsImRvYyIsImdldERvYyIsImdldEZpcmVzdG9yZSIsInNldERvYyIsInVwZGF0ZURvYyIsIkZJUkVfQVBJX0tFWSIsIkZJUkVfRE9NQUlOIiwiRklSRV9QUk9KRUNUX0lEIiwicHJvY2VzcyIsImVudiIsImZpcmViYXNlQ29uZmlnIiwiYXBpS2V5IiwiYXV0aERvbWFpbiIsInByb2plY3RJZCIsImFwcCIsImRiIiwic2V0VXNlciIsInVzZXIiLCJlbWFpbCIsImlkIiwidXNlcm5hbWUiLCJyZWYiLCJTdHJpbmciLCJkYXRhIiwibWVyZ2UiLCJzZXRTdG9yZSIsInNlc3Npb24iLCJhY2Nlc3NfdG9rZW4iLCJhY2Nlc3NUb2tlbiIsImNvbnRleHQiLCJzY29wZSIsInN0b3JlSGFzaCIsInNwbGl0IiwiYWRtaW5JZCIsInNldFN0b3JlVXNlciIsIm93bmVyIiwic3ViIiwidXNlcklkIiwiY29udGV4dFN0cmluZyIsImRvY3VtZW50SWQiLCJzdG9yZVVzZXIiLCJleGlzdHMiLCJpc0FkbWluIiwiZGVsZXRlVXNlciIsImRvY0lkIiwiaGFzU3RvcmVVc2VyIiwidXNlckRvYyIsImdldFN0b3JlVG9rZW4iLCJzdG9yZURvYyIsImRlbGV0ZVN0b3JlIiwic3RvcmVfaGFzaCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/dbs/firebase.ts\n");

/***/ }),

/***/ "(api)/./lib/dbs/mysql.ts":
/*!**************************!*\
  !*** ./lib/dbs/mysql.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"deleteStore\": () => (/* binding */ deleteStore),\n/* harmony export */   \"deleteUser\": () => (/* binding */ deleteUser),\n/* harmony export */   \"getStoreToken\": () => (/* binding */ getStoreToken),\n/* harmony export */   \"hasStoreUser\": () => (/* binding */ hasStoreUser),\n/* harmony export */   \"setStore\": () => (/* binding */ setStore),\n/* harmony export */   \"setStoreUser\": () => (/* binding */ setStoreUser),\n/* harmony export */   \"setUser\": () => (/* binding */ setUser)\n/* harmony export */ });\n/* harmony import */ var mysql__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mysql */ \"mysql\");\n/* harmony import */ var mysql__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mysql__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_1__);\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\nconst MYSQL_CONFIG = _objectSpread({\n  host: process.env.MYSQL_HOST,\n  database: process.env.MYSQL_DATABASE,\n  user: process.env.MYSQL_USERNAME,\n  password: process.env.MYSQL_PASSWORD\n}, process.env.MYSQL_PORT && {\n  port: process.env.MYSQL_PORT\n}); // For use with Heroku ClearDB\n// Other mysql: https://www.npmjs.com/package/mysql#pooling-connections\n\n\nconst pool = mysql__WEBPACK_IMPORTED_MODULE_0__.createPool(process.env.CLEARDB_DATABASE_URL ? process.env.CLEARDB_DATABASE_URL : MYSQL_CONFIG);\nconst query = (0,util__WEBPACK_IMPORTED_MODULE_1__.promisify)(pool.query.bind(pool)); // Use setUser for storing global user data (persists between installs)\n\nasync function setUser({\n  user\n}) {\n  if (!user) return null;\n  const {\n    email,\n    id,\n    username\n  } = user;\n  const userData = {\n    email,\n    userId: id,\n    username\n  };\n  await query('REPLACE INTO users SET ?', userData);\n}\nasync function setStore(session) {\n  const {\n    access_token: accessToken,\n    context,\n    scope\n  } = session; // Only set on app install or update\n\n  if (!accessToken || !scope) return null;\n  const storeHash = (context === null || context === void 0 ? void 0 : context.split('/')[1]) || '';\n  const storeData = {\n    accessToken,\n    scope,\n    storeHash\n  };\n  await query('REPLACE INTO stores SET ?', storeData);\n} // Use setStoreUser for storing store specific variables\n\nasync function setStoreUser(session) {\n  const {\n    access_token: accessToken,\n    context,\n    owner,\n    sub,\n    user: {\n      id: userId\n    }\n  } = session;\n  if (!userId) return null;\n  const contextString = context ?? sub;\n  const storeHash = (contextString === null || contextString === void 0 ? void 0 : contextString.split('/')[1]) || '';\n  const sql = 'SELECT * FROM storeUsers WHERE userId = ? AND storeHash = ?';\n  const values = [String(userId), storeHash];\n  const storeUser = await query(sql, values); // Set admin (store owner) if installing/ updating the app\n  // https://developer.bigcommerce.com/api-docs/apps/guide/users\n\n  if (accessToken) {\n    var _storeUser$;\n\n    // Create a new admin user if none exists\n    if (!storeUser.length) {\n      await query('INSERT INTO storeUsers SET ?', {\n        isAdmin: true,\n        storeHash,\n        userId\n      });\n    } else if (!((_storeUser$ = storeUser[0]) !== null && _storeUser$ !== void 0 && _storeUser$.isAdmin)) {\n      await query('UPDATE storeUsers SET isAdmin=1 WHERE userId = ? AND storeHash = ?', values);\n    }\n  } else {\n    // Create a new user if it doesn't exist (non-store owners added here for multi-user apps)\n    if (!storeUser.length) {\n      await query('INSERT INTO storeUsers SET ?', {\n        isAdmin: owner.id === userId,\n        storeHash,\n        userId\n      });\n    }\n  }\n}\nasync function deleteUser({\n  context,\n  user,\n  sub\n}) {\n  const contextString = context ?? sub;\n  const storeHash = (contextString === null || contextString === void 0 ? void 0 : contextString.split('/')[1]) || '';\n  const values = [String(user === null || user === void 0 ? void 0 : user.id), storeHash];\n  await query('DELETE FROM storeUsers WHERE userId = ? AND storeHash = ?', values);\n}\nasync function hasStoreUser(storeHash, userId) {\n  if (!storeHash || !userId) return false;\n  const values = [userId, storeHash];\n  const results = await query('SELECT * FROM storeUsers WHERE userId = ? AND storeHash = ? LIMIT 1', values);\n  return results.length > 0;\n}\nasync function getStoreToken(storeHash) {\n  if (!storeHash) return null;\n  const results = await query('SELECT accessToken FROM stores WHERE storeHash = ?', storeHash);\n  return results.length ? results[0].accessToken : null;\n}\nasync function deleteStore({\n  store_hash: storeHash\n}) {\n  await query('DELETE FROM stores WHERE storeHash = ?', storeHash);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZGJzL215c3FsLnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTs7QUFHQSxNQUFNRSxZQUFZO0VBQ2RDLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBREo7RUFFZEMsUUFBUSxFQUFFSCxPQUFPLENBQUNDLEdBQVIsQ0FBWUcsY0FGUjtFQUdkQyxJQUFJLEVBQUVMLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSyxjQUhKO0VBSWRDLFFBQVEsRUFBRVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPO0FBSlIsR0FLVlIsT0FBTyxDQUFDQyxHQUFSLENBQVlRLFVBQVosSUFBMEI7RUFBRUMsSUFBSSxFQUFFVixPQUFPLENBQUNDLEdBQVIsQ0FBWVE7QUFBcEIsQ0FMaEIsQ0FBbEIsRUFRQTtBQUNBOzs7QUFDQSxNQUFNRSxJQUFJLEdBQUdmLDZDQUFBLENBQWlCSSxPQUFPLENBQUNDLEdBQVIsQ0FBWVksb0JBQVosR0FBbUNiLE9BQU8sQ0FBQ0MsR0FBUixDQUFZWSxvQkFBL0MsR0FBc0VmLFlBQXZGLENBQWI7QUFDQSxNQUFNZ0IsS0FBSyxHQUFHakIsK0NBQVMsQ0FBQ2MsSUFBSSxDQUFDRyxLQUFMLENBQVdDLElBQVgsQ0FBZ0JKLElBQWhCLENBQUQsQ0FBdkIsRUFFQTs7QUFDTyxlQUFlSyxPQUFmLENBQXVCO0VBQUVYO0FBQUYsQ0FBdkIsRUFBK0M7RUFDbEQsSUFBSSxDQUFDQSxJQUFMLEVBQVcsT0FBTyxJQUFQO0VBRVgsTUFBTTtJQUFFWSxLQUFGO0lBQVNDLEVBQVQ7SUFBYUM7RUFBYixJQUEwQmQsSUFBaEM7RUFDQSxNQUFNZSxRQUFRLEdBQUc7SUFBRUgsS0FBRjtJQUFTSSxNQUFNLEVBQUVILEVBQWpCO0lBQXFCQztFQUFyQixDQUFqQjtFQUVBLE1BQU1MLEtBQUssQ0FBQywwQkFBRCxFQUE2Qk0sUUFBN0IsQ0FBWDtBQUNIO0FBRU0sZUFBZUUsUUFBZixDQUF3QkMsT0FBeEIsRUFBK0M7RUFDbEQsTUFBTTtJQUFFQyxZQUFZLEVBQUVDLFdBQWhCO0lBQTZCQyxPQUE3QjtJQUFzQ0M7RUFBdEMsSUFBZ0RKLE9BQXRELENBRGtELENBRWxEOztFQUNBLElBQUksQ0FBQ0UsV0FBRCxJQUFnQixDQUFDRSxLQUFyQixFQUE0QixPQUFPLElBQVA7RUFFNUIsTUFBTUMsU0FBUyxHQUFHLENBQUFGLE9BQU8sU0FBUCxJQUFBQSxPQUFPLFdBQVAsWUFBQUEsT0FBTyxDQUFFRyxLQUFULENBQWUsR0FBZixFQUFvQixDQUFwQixNQUEwQixFQUE1QztFQUNBLE1BQU1DLFNBQW9CLEdBQUc7SUFBRUwsV0FBRjtJQUFlRSxLQUFmO0lBQXNCQztFQUF0QixDQUE3QjtFQUVBLE1BQU1kLEtBQUssQ0FBQywyQkFBRCxFQUE4QmdCLFNBQTlCLENBQVg7QUFDSCxFQUVEOztBQUNPLGVBQWVDLFlBQWYsQ0FBNEJSLE9BQTVCLEVBQW1EO0VBQ3RELE1BQU07SUFBRUMsWUFBWSxFQUFFQyxXQUFoQjtJQUE2QkMsT0FBN0I7SUFBc0NNLEtBQXRDO0lBQTZDQyxHQUE3QztJQUFrRDVCLElBQUksRUFBRTtNQUFFYSxFQUFFLEVBQUVHO0lBQU47RUFBeEQsSUFBMkVFLE9BQWpGO0VBQ0EsSUFBSSxDQUFDRixNQUFMLEVBQWEsT0FBTyxJQUFQO0VBRWIsTUFBTWEsYUFBYSxHQUFHUixPQUFPLElBQUlPLEdBQWpDO0VBQ0EsTUFBTUwsU0FBUyxHQUFHLENBQUFNLGFBQWEsU0FBYixJQUFBQSxhQUFhLFdBQWIsWUFBQUEsYUFBYSxDQUFFTCxLQUFmLENBQXFCLEdBQXJCLEVBQTBCLENBQTFCLE1BQWdDLEVBQWxEO0VBQ0EsTUFBTU0sR0FBRyxHQUFHLDZEQUFaO0VBQ0EsTUFBTUMsTUFBTSxHQUFHLENBQUNDLE1BQU0sQ0FBQ2hCLE1BQUQsQ0FBUCxFQUFpQk8sU0FBakIsQ0FBZjtFQUNBLE1BQU1VLFNBQVMsR0FBRyxNQUFNeEIsS0FBSyxDQUFDcUIsR0FBRCxFQUFNQyxNQUFOLENBQTdCLENBUnNELENBVXREO0VBQ0E7O0VBQ0EsSUFBSVgsV0FBSixFQUFpQjtJQUFBOztJQUNiO0lBQ0EsSUFBSSxDQUFDYSxTQUFTLENBQUNDLE1BQWYsRUFBdUI7TUFDbkIsTUFBTXpCLEtBQUssQ0FBQyw4QkFBRCxFQUFpQztRQUFFMEIsT0FBTyxFQUFFLElBQVg7UUFBaUJaLFNBQWpCO1FBQTRCUDtNQUE1QixDQUFqQyxDQUFYO0lBQ0gsQ0FGRCxNQUVPLElBQUksaUJBQUNpQixTQUFTLENBQUMsQ0FBRCxDQUFWLHdDQUFDLFlBQWNFLE9BQWYsQ0FBSixFQUE0QjtNQUMvQixNQUFNMUIsS0FBSyxDQUFDLG9FQUFELEVBQXVFc0IsTUFBdkUsQ0FBWDtJQUNIO0VBQ0osQ0FQRCxNQU9PO0lBQ0g7SUFDQSxJQUFJLENBQUNFLFNBQVMsQ0FBQ0MsTUFBZixFQUF1QjtNQUNuQixNQUFNekIsS0FBSyxDQUFDLDhCQUFELEVBQWlDO1FBQUUwQixPQUFPLEVBQUVSLEtBQUssQ0FBQ2QsRUFBTixLQUFhRyxNQUF4QjtRQUFnQ08sU0FBaEM7UUFBMkNQO01BQTNDLENBQWpDLENBQVg7SUFDSDtFQUNKO0FBQ0o7QUFFTSxlQUFlb0IsVUFBZixDQUEwQjtFQUFFZixPQUFGO0VBQVdyQixJQUFYO0VBQWlCNEI7QUFBakIsQ0FBMUIsRUFBZ0U7RUFDbkUsTUFBTUMsYUFBYSxHQUFHUixPQUFPLElBQUlPLEdBQWpDO0VBQ0EsTUFBTUwsU0FBUyxHQUFHLENBQUFNLGFBQWEsU0FBYixJQUFBQSxhQUFhLFdBQWIsWUFBQUEsYUFBYSxDQUFFTCxLQUFmLENBQXFCLEdBQXJCLEVBQTBCLENBQTFCLE1BQWdDLEVBQWxEO0VBQ0EsTUFBTU8sTUFBTSxHQUFHLENBQUNDLE1BQU0sQ0FBQ2hDLElBQUQsYUFBQ0EsSUFBRCx1QkFBQ0EsSUFBSSxDQUFFYSxFQUFQLENBQVAsRUFBbUJVLFNBQW5CLENBQWY7RUFDQSxNQUFNZCxLQUFLLENBQUMsMkRBQUQsRUFBOERzQixNQUE5RCxDQUFYO0FBQ0g7QUFFTSxlQUFlTSxZQUFmLENBQTRCZCxTQUE1QixFQUErQ1AsTUFBL0MsRUFBK0Q7RUFDbEUsSUFBSSxDQUFDTyxTQUFELElBQWMsQ0FBQ1AsTUFBbkIsRUFBMkIsT0FBTyxLQUFQO0VBRTNCLE1BQU1lLE1BQU0sR0FBRyxDQUFDZixNQUFELEVBQVNPLFNBQVQsQ0FBZjtFQUNBLE1BQU1lLE9BQU8sR0FBRyxNQUFNN0IsS0FBSyxDQUFDLHFFQUFELEVBQXdFc0IsTUFBeEUsQ0FBM0I7RUFFQSxPQUFPTyxPQUFPLENBQUNKLE1BQVIsR0FBaUIsQ0FBeEI7QUFDSDtBQUVNLGVBQWVLLGFBQWYsQ0FBNkJoQixTQUE3QixFQUFnRDtFQUNuRCxJQUFJLENBQUNBLFNBQUwsRUFBZ0IsT0FBTyxJQUFQO0VBRWhCLE1BQU1lLE9BQU8sR0FBRyxNQUFNN0IsS0FBSyxDQUFDLG9EQUFELEVBQXVEYyxTQUF2RCxDQUEzQjtFQUVBLE9BQU9lLE9BQU8sQ0FBQ0osTUFBUixHQUFpQkksT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXbEIsV0FBNUIsR0FBMEMsSUFBakQ7QUFDSDtBQUVNLGVBQWVvQixXQUFmLENBQTJCO0VBQUVDLFVBQVUsRUFBRWxCO0FBQWQsQ0FBM0IsRUFBb0U7RUFDdkUsTUFBTWQsS0FBSyxDQUFDLHdDQUFELEVBQTJDYyxTQUEzQyxDQUFYO0FBQ0giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYW1wbGUtYXBwLW5vZGVqcy8uL2xpYi9kYnMvbXlzcWwudHM/ODY0OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBteXNxbCBmcm9tICdteXNxbCc7XHJcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnO1xyXG5pbXBvcnQgeyBTZXNzaW9uUHJvcHMsIFN0b3JlRGF0YSB9IGZyb20gJy4uLy4uL3R5cGVzJztcclxuXHJcbmNvbnN0IE1ZU1FMX0NPTkZJRyA9IHtcclxuICAgIGhvc3Q6IHByb2Nlc3MuZW52Lk1ZU1FMX0hPU1QsXHJcbiAgICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuTVlTUUxfREFUQUJBU0UsXHJcbiAgICB1c2VyOiBwcm9jZXNzLmVudi5NWVNRTF9VU0VSTkFNRSxcclxuICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5NWVNRTF9QQVNTV09SRCxcclxuICAgIC4uLihwcm9jZXNzLmVudi5NWVNRTF9QT1JUICYmIHsgcG9ydDogcHJvY2Vzcy5lbnYuTVlTUUxfUE9SVCB9KSxcclxufTtcclxuXHJcbi8vIEZvciB1c2Ugd2l0aCBIZXJva3UgQ2xlYXJEQlxyXG4vLyBPdGhlciBteXNxbDogaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbXlzcWwjcG9vbGluZy1jb25uZWN0aW9uc1xyXG5jb25zdCBwb29sID0gbXlzcWwuY3JlYXRlUG9vbChwcm9jZXNzLmVudi5DTEVBUkRCX0RBVEFCQVNFX1VSTCA/IHByb2Nlc3MuZW52LkNMRUFSREJfREFUQUJBU0VfVVJMIDogTVlTUUxfQ09ORklHKTtcclxuY29uc3QgcXVlcnkgPSBwcm9taXNpZnkocG9vbC5xdWVyeS5iaW5kKHBvb2wpKTtcclxuXHJcbi8vIFVzZSBzZXRVc2VyIGZvciBzdG9yaW5nIGdsb2JhbCB1c2VyIGRhdGEgKHBlcnNpc3RzIGJldHdlZW4gaW5zdGFsbHMpXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRVc2VyKHsgdXNlciB9OiBTZXNzaW9uUHJvcHMpIHtcclxuICAgIGlmICghdXNlcikgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgY29uc3QgeyBlbWFpbCwgaWQsIHVzZXJuYW1lIH0gPSB1c2VyO1xyXG4gICAgY29uc3QgdXNlckRhdGEgPSB7IGVtYWlsLCB1c2VySWQ6IGlkLCB1c2VybmFtZSB9O1xyXG5cclxuICAgIGF3YWl0IHF1ZXJ5KCdSRVBMQUNFIElOVE8gdXNlcnMgU0VUID8nLCB1c2VyRGF0YSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRTdG9yZShzZXNzaW9uOiBTZXNzaW9uUHJvcHMpIHtcclxuICAgIGNvbnN0IHsgYWNjZXNzX3Rva2VuOiBhY2Nlc3NUb2tlbiwgY29udGV4dCwgc2NvcGUgfSA9IHNlc3Npb247XHJcbiAgICAvLyBPbmx5IHNldCBvbiBhcHAgaW5zdGFsbCBvciB1cGRhdGVcclxuICAgIGlmICghYWNjZXNzVG9rZW4gfHwgIXNjb3BlKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICBjb25zdCBzdG9yZUhhc2ggPSBjb250ZXh0Py5zcGxpdCgnLycpWzFdIHx8ICcnO1xyXG4gICAgY29uc3Qgc3RvcmVEYXRhOiBTdG9yZURhdGEgPSB7IGFjY2Vzc1Rva2VuLCBzY29wZSwgc3RvcmVIYXNoIH07XHJcblxyXG4gICAgYXdhaXQgcXVlcnkoJ1JFUExBQ0UgSU5UTyBzdG9yZXMgU0VUID8nLCBzdG9yZURhdGEpO1xyXG59XHJcblxyXG4vLyBVc2Ugc2V0U3RvcmVVc2VyIGZvciBzdG9yaW5nIHN0b3JlIHNwZWNpZmljIHZhcmlhYmxlc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0U3RvcmVVc2VyKHNlc3Npb246IFNlc3Npb25Qcm9wcykge1xyXG4gICAgY29uc3QgeyBhY2Nlc3NfdG9rZW46IGFjY2Vzc1Rva2VuLCBjb250ZXh0LCBvd25lciwgc3ViLCB1c2VyOiB7IGlkOiB1c2VySWQgfSB9ID0gc2Vzc2lvbjtcclxuICAgIGlmICghdXNlcklkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICBjb25zdCBjb250ZXh0U3RyaW5nID0gY29udGV4dCA/PyBzdWI7XHJcbiAgICBjb25zdCBzdG9yZUhhc2ggPSBjb250ZXh0U3RyaW5nPy5zcGxpdCgnLycpWzFdIHx8ICcnO1xyXG4gICAgY29uc3Qgc3FsID0gJ1NFTEVDVCAqIEZST00gc3RvcmVVc2VycyBXSEVSRSB1c2VySWQgPSA/IEFORCBzdG9yZUhhc2ggPSA/JztcclxuICAgIGNvbnN0IHZhbHVlcyA9IFtTdHJpbmcodXNlcklkKSwgc3RvcmVIYXNoXTtcclxuICAgIGNvbnN0IHN0b3JlVXNlciA9IGF3YWl0IHF1ZXJ5KHNxbCwgdmFsdWVzKTtcclxuXHJcbiAgICAvLyBTZXQgYWRtaW4gKHN0b3JlIG93bmVyKSBpZiBpbnN0YWxsaW5nLyB1cGRhdGluZyB0aGUgYXBwXHJcbiAgICAvLyBodHRwczovL2RldmVsb3Blci5iaWdjb21tZXJjZS5jb20vYXBpLWRvY3MvYXBwcy9ndWlkZS91c2Vyc1xyXG4gICAgaWYgKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGFkbWluIHVzZXIgaWYgbm9uZSBleGlzdHNcclxuICAgICAgICBpZiAoIXN0b3JlVXNlci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgYXdhaXQgcXVlcnkoJ0lOU0VSVCBJTlRPIHN0b3JlVXNlcnMgU0VUID8nLCB7IGlzQWRtaW46IHRydWUsIHN0b3JlSGFzaCwgdXNlcklkIH0pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXN0b3JlVXNlclswXT8uaXNBZG1pbikge1xyXG4gICAgICAgICAgICBhd2FpdCBxdWVyeSgnVVBEQVRFIHN0b3JlVXNlcnMgU0VUIGlzQWRtaW49MSBXSEVSRSB1c2VySWQgPSA/IEFORCBzdG9yZUhhc2ggPSA/JywgdmFsdWVzKTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyB1c2VyIGlmIGl0IGRvZXNuJ3QgZXhpc3QgKG5vbi1zdG9yZSBvd25lcnMgYWRkZWQgaGVyZSBmb3IgbXVsdGktdXNlciBhcHBzKVxyXG4gICAgICAgIGlmICghc3RvcmVVc2VyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBhd2FpdCBxdWVyeSgnSU5TRVJUIElOVE8gc3RvcmVVc2VycyBTRVQgPycsIHsgaXNBZG1pbjogb3duZXIuaWQgPT09IHVzZXJJZCwgc3RvcmVIYXNoLCB1c2VySWQgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlVXNlcih7IGNvbnRleHQsIHVzZXIsIHN1YiB9OiBTZXNzaW9uUHJvcHMpIHtcclxuICAgIGNvbnN0IGNvbnRleHRTdHJpbmcgPSBjb250ZXh0ID8/IHN1YjtcclxuICAgIGNvbnN0IHN0b3JlSGFzaCA9IGNvbnRleHRTdHJpbmc/LnNwbGl0KCcvJylbMV0gfHwgJyc7XHJcbiAgICBjb25zdCB2YWx1ZXMgPSBbU3RyaW5nKHVzZXI/LmlkKSwgc3RvcmVIYXNoXTtcclxuICAgIGF3YWl0IHF1ZXJ5KCdERUxFVEUgRlJPTSBzdG9yZVVzZXJzIFdIRVJFIHVzZXJJZCA9ID8gQU5EIHN0b3JlSGFzaCA9ID8nLCB2YWx1ZXMpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzU3RvcmVVc2VyKHN0b3JlSGFzaDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xyXG4gICAgaWYgKCFzdG9yZUhhc2ggfHwgIXVzZXJJZCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IHZhbHVlcyA9IFt1c2VySWQsIHN0b3JlSGFzaF07XHJcbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgcXVlcnkoJ1NFTEVDVCAqIEZST00gc3RvcmVVc2VycyBXSEVSRSB1c2VySWQgPSA/IEFORCBzdG9yZUhhc2ggPSA/IExJTUlUIDEnLCB2YWx1ZXMpO1xyXG5cclxuICAgIHJldHVybiByZXN1bHRzLmxlbmd0aCA+IDA7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTdG9yZVRva2VuKHN0b3JlSGFzaDogc3RyaW5nKSB7XHJcbiAgICBpZiAoIXN0b3JlSGFzaCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHF1ZXJ5KCdTRUxFQ1QgYWNjZXNzVG9rZW4gRlJPTSBzdG9yZXMgV0hFUkUgc3RvcmVIYXNoID0gPycsIHN0b3JlSGFzaCk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoID8gcmVzdWx0c1swXS5hY2Nlc3NUb2tlbiA6IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVTdG9yZSh7IHN0b3JlX2hhc2g6IHN0b3JlSGFzaCB9OiBTZXNzaW9uUHJvcHMpIHtcclxuICAgIGF3YWl0IHF1ZXJ5KCdERUxFVEUgRlJPTSBzdG9yZXMgV0hFUkUgc3RvcmVIYXNoID0gPycsIHN0b3JlSGFzaCk7XHJcbn1cclxuIl0sIm5hbWVzIjpbIm15c3FsIiwicHJvbWlzaWZ5IiwiTVlTUUxfQ09ORklHIiwiaG9zdCIsInByb2Nlc3MiLCJlbnYiLCJNWVNRTF9IT1NUIiwiZGF0YWJhc2UiLCJNWVNRTF9EQVRBQkFTRSIsInVzZXIiLCJNWVNRTF9VU0VSTkFNRSIsInBhc3N3b3JkIiwiTVlTUUxfUEFTU1dPUkQiLCJNWVNRTF9QT1JUIiwicG9ydCIsInBvb2wiLCJjcmVhdGVQb29sIiwiQ0xFQVJEQl9EQVRBQkFTRV9VUkwiLCJxdWVyeSIsImJpbmQiLCJzZXRVc2VyIiwiZW1haWwiLCJpZCIsInVzZXJuYW1lIiwidXNlckRhdGEiLCJ1c2VySWQiLCJzZXRTdG9yZSIsInNlc3Npb24iLCJhY2Nlc3NfdG9rZW4iLCJhY2Nlc3NUb2tlbiIsImNvbnRleHQiLCJzY29wZSIsInN0b3JlSGFzaCIsInNwbGl0Iiwic3RvcmVEYXRhIiwic2V0U3RvcmVVc2VyIiwib3duZXIiLCJzdWIiLCJjb250ZXh0U3RyaW5nIiwic3FsIiwidmFsdWVzIiwiU3RyaW5nIiwic3RvcmVVc2VyIiwibGVuZ3RoIiwiaXNBZG1pbiIsImRlbGV0ZVVzZXIiLCJoYXNTdG9yZVVzZXIiLCJyZXN1bHRzIiwiZ2V0U3RvcmVUb2tlbiIsImRlbGV0ZVN0b3JlIiwic3RvcmVfaGFzaCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/dbs/mysql.ts\n");

/***/ }),

/***/ "(api)/./pages/api/uninstall.ts":
/*!********************************!*\
  !*** ./pages/api/uninstall.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ uninstall)\n/* harmony export */ });\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/auth */ \"(api)/./lib/auth.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_auth__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_auth__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function uninstall(req, res) {\n  try {\n    const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_0__.getBCVerify)(req.query);\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_0__.removeDataStore)(session);\n    res.status(200).end();\n  } catch (error) {\n    const {\n      message,\n      response\n    } = error;\n    res.status((response === null || response === void 0 ? void 0 : response.status) || 500).json({\n      message\n    });\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdW5pbnN0YWxsLnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0E7QUFFZSxlQUFlRSxTQUFmLENBQXlCQyxHQUF6QixFQUE4Q0MsR0FBOUMsRUFBb0U7RUFDL0UsSUFBSTtJQUNBLE1BQU1DLE9BQU8sR0FBRyxNQUFNTCxzREFBVyxDQUFDRyxHQUFHLENBQUNHLEtBQUwsQ0FBakM7SUFFQSxNQUFNTCwwREFBZSxDQUFDSSxPQUFELENBQXJCO0lBQ0FELEdBQUcsQ0FBQ0csTUFBSixDQUFXLEdBQVgsRUFBZ0JDLEdBQWhCO0VBQ0gsQ0FMRCxDQUtFLE9BQU9DLEtBQVAsRUFBYztJQUNaLE1BQU07TUFBRUMsT0FBRjtNQUFXQztJQUFYLElBQXdCRixLQUE5QjtJQUNBTCxHQUFHLENBQUNHLE1BQUosQ0FBVyxDQUFBSSxRQUFRLFNBQVIsSUFBQUEsUUFBUSxXQUFSLFlBQUFBLFFBQVEsQ0FBRUosTUFBVixLQUFvQixHQUEvQixFQUFvQ0ssSUFBcEMsQ0FBeUM7TUFBRUY7SUFBRixDQUF6QztFQUNIO0FBQ0osQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NhbXBsZS1hcHAtbm9kZWpzLy4vcGFnZXMvYXBpL3VuaW5zdGFsbC50cz9mY2M4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IHsgZ2V0QkNWZXJpZnksIHJlbW92ZURhdGFTdG9yZSB9IGZyb20gJy4uLy4uL2xpYi9hdXRoJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIHVuaW5zdGFsbChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0QkNWZXJpZnkocmVxLnF1ZXJ5KTtcclxuXHJcbiAgICAgICAgYXdhaXQgcmVtb3ZlRGF0YVN0b3JlKHNlc3Npb24pO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5lbmQoKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlLCByZXNwb25zZSB9ID0gZXJyb3I7XHJcbiAgICAgICAgcmVzLnN0YXR1cyhyZXNwb25zZT8uc3RhdHVzIHx8IDUwMCkuanNvbih7IG1lc3NhZ2UgfSk7XHJcbiAgICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImdldEJDVmVyaWZ5IiwicmVtb3ZlRGF0YVN0b3JlIiwidW5pbnN0YWxsIiwicmVxIiwicmVzIiwic2Vzc2lvbiIsInF1ZXJ5Iiwic3RhdHVzIiwiZW5kIiwiZXJyb3IiLCJtZXNzYWdlIiwicmVzcG9uc2UiLCJqc29uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/uninstall.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/uninstall.ts"));
module.exports = __webpack_exports__;

})();